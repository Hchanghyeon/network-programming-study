
## 무중단 배포를 생각하게 된 배경
- 프로젝트 때 직접 구현했던 CI/CD는 Docker 이미지의 다운타임이 존재
- Docker 이미지의 다운 타임이란, Docker 이미지를 새로 받고 새로운 버전으로 Spring Boot를 가동시켜야하는데 이미 실행되고 있는 도커 이미지를 다운시키고 재실행 할 때의 그 다운타임을 의미함

## 해결 방법
- 무중단 배포의 여러가지 전략을 통해 해결할 수 있음
- 무중단 배포란 말 그대로 서비스가 중단되지 않은 상태로 

### 1. 롤링 배포
- 점진적으로 구버전에서 새로운 버전으로 옮기는 방식

#### 첫번째
- 인스턴스를 하나 추가하고, 새로운 버전을 실행
- 로드 밸런서에 이 인스턴스를 연결하고 기존 구 버전 어플리케이션이 실행되는 인스턴스 하나를 줄임
- 나머지도 새로운 버전을 실행

#### 두번째
- 기존 버전이 실행되고 있는 서비스 하나를 로드밸런서에서 떼어내고, 해당 서버의 버전을 새로운 버전으로 실행
- 이 과정을 반복하여 전부 다 새로운 버전으로 적용


#### 장점
- 많은 오케스트레이션 도구에서 지원하여 간편
- 많은 서버 자원을 확보하지 않아도 무중단 배포 가능

#### 단점
- 배포 도중 서비스 중인 인스턴스의 수가 줄어들게되어 각각의 서버가 부담하는 트래픽 증가 가능성
- 트래픽의 양을 잘 파악해서 배포 해야 됨 -> 새벽 시간대 하면 좋을 것 같다고 생각 함
- 구 버전과 신버전에 대한 서비스가 동시에 진행되어 호환성 문제 발생 가능성 존재

### 2. Blue/Green 배포
- 트래픽을 한번에 구버전에서 신버전으로 옮기는 방법
- 현재 운영중인 서비스의 환경을 Blue라고 부르고, 새롭게 배포할 환경을 Green이라 부름
- Blue와 Green의 서버를 동시에 나란히 구성해둔 상태로 배포 시점에 로드 밸런서가 트래픽을 Blue에서 Green으로 일제히 전환시킴
- Green 버전 배포가 성공적으로 완료되고 문제 없다고 생각될 때 Blue 서버 제거 가능

#### 장점
- 호환성 문제를 해결할 수 있음
- 트래픽이 그대로 전환되기 때문에 똑같은 트래픽양 감당

#### 단점
- 실제 운영에 필요한 서버 리소스를 2배나 확보해야함. 클라우드 환경에서는 괜찮지만 온프레미스에서는 부담스러운 방식

### 3. 카나리(Canary)
- 구버전에 대한 트래픽을 신버전으로 옮기는 방식은 롤링 배포와 비슷
- 새로운 버전에 대한 오류를 조기에 감지하는 방식
- 소수 인원에 대해서만 트래픽을 새로운 버전에 옮김 Green에 10% -> 30% -> 50% -> 70% -> 100%
- 새로운 버전에 이상 없을 경우 100% 그대로 사용

#### 장점
- 새로운 버전에 대한 위험 최소화 가능
- 롤링 배포와 마찬가지로 신/구 버전의 애플리케이션이 동시에 존재로 호환성 문제 발생 가능



